

# خطة إضافة دور "بائعة منتجات" (Seller)

## المشكلة
حالياً النظام يدعم 3 أدوار فقط: `customer`, `artist`, `admin`. خبيرات التجميل اللي يبيعون منتجات فقط بدون تقديم خدمات تجميل ما عندهم دور مناسب. دور `artist` مصمم للي يقدمون خدمات حجوزات + منتجات.

## الحل المقترح
إضافة دور جديد `seller` (بائعة منتجات) مع واجهة مخصصة تركز على المتجر فقط بدون نظام الحجوزات والخدمات.

---

## المراحل

### المرحلة 1: تعديل قاعدة البيانات
- إضافة قيمة `seller` للـ `app_role` enum
- تحديث دالة `has_role` لدعم الدور الجديد
- إضافة RLS policies للسماح للبائعات بإدارة منتجاتهم
- إنشاء سجل في جدول `artists` للبائعة (لأن المنتجات مرتبطة بـ `artist_id`) أو إنشاء جدول `sellers` منفصل

**قرار تصميمي مهم**: استخدام جدول `artists` نفسه للبائعات مع إضافة عمود `account_type` (قيم: `artist`, `seller`) لتمييز النوع. هذا يتجنب تكرار البنية ويحافظ على ربط المنتجات بنفس الطريقة.

### المرحلة 2: تحديث نظام الأدوار في الكود
- تحديث `useUserRole.ts` لإضافة `seller` كنوع دور
- تحديث `RoleGate.tsx` لدعم الدور الجديد
- إضافة التوجيه الافتراضي للبائعة (`/seller-dashboard`)

### المرحلة 3: إنشاء واجهة البائعة
- **صفحة لوحة التحكم** (`/seller-dashboard`): إحصائيات المبيعات والطلبات
- **صفحة المنتجات** (`/seller-products`): إعادة استخدام مكونات `ArtistProducts` الموجودة
- **صفحة الطلبات** (`/seller-orders`): عرض وإدارة الطلبات
- **شريط تنقل سفلي مخصص**: Dashboard, Products, Orders, Profile

### المرحلة 4: صفحة تسجيل البائعات
- إنشاء صفحة `/seller-signup` مشابهة لـ `/artist-signup`
- حقول التسجيل: الاسم، البريد، الهاتف، كلمة المرور، وصف المتجر
- عند التسجيل: إنشاء المستخدم + دور `seller` + سجل في `artists` مع `account_type = 'seller'`

### المرحلة 5: تحديث صفحة اكتشاف البائعات
- إضافة تبويب "المتجر" أو قسم منفصل في الصفحة الرئيسية لعرض منتجات البائعات
- تعديل عرض بطاقة البائعة لإظهار المنتجات بدلاً من الخدمات

### المرحلة 6: تحديث لوحة الأدمن
- إضافة إدارة البائعات في لوحة الأدمن
- إمكانية تغيير الدور من/إلى `seller`

---

## التفاصيل التقنية

### تعديلات قاعدة البيانات
```text
1. ALTER TYPE app_role ADD VALUE 'seller'
2. ALTER TABLE artists ADD COLUMN account_type text DEFAULT 'artist'
3. تحديث RLS policies لجدول products للسماح للبائعات
4. تحديث edge function: admin-update-role لدعم seller
```

### الملفات المتأثرة
| الملف | التعديل |
|-------|---------|
| `src/hooks/useUserRole.ts` | إضافة `seller` للـ AppRole type ومنطق الأولوية |
| `src/components/auth/RoleGate.tsx` | إضافة redirect للـ seller |
| `src/components/BottomNavigation.tsx` | إضافة شريط تنقل البائعة |
| `src/App.tsx` | إضافة routes البائعة |
| `src/lib/translations/ar.ts` و `en.ts` | إضافة ترجمات البائعة |

### صفحات جديدة
| الصفحة | المسار |
|--------|--------|
| SellerDashboard | `/seller-dashboard` |
| SellerProducts | `/seller-products` |
| SellerOrders | `/seller-orders` |
| SellerSignup | `/seller-signup` |

### شريط التنقل السفلي للبائعة
```text
[Dashboard] [Products] [Orders] [Profile]
```

### أولوية الأدوار المحدثة
```text
admin > artist > seller > customer
```

---

## ملاحظات
- يمكن للبائعة لاحقاً الترقية لدور `artist` إذا أرادت تقديم خدمات تجميل
- المنتجات والطلبات تستخدم نفس البنية الموجودة حالياً (جداول `products` و `product_orders`)
- نظام المحادثات والإشعارات يعمل مع البائعة بنفس الطريقة

